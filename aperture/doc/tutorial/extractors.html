<html>

<head>
	<title>Aperture - Tutorials - Extractors</title>
	<link rel="stylesheet" type="text/css" href="../style/default/documentation.css">
</head>

<body>

<h1>Extractors</h1>

<p>
Extractors extract the full-text and/or metadata of a particular document type
(one or more MIME types). They operate on an InputStream, optionally accompanied by a
MIME type and/or a Charset to tune the processing, and produce a set of RDF statements
describing the full-text and metadata.
</p>

<p>
The extractor classes are summarized in the following diagram:
</p>

<img src="../uml/Extractors.png">

<p>
The current set of Extractors focus on typical document-like formats, such as word processor
documents, spreadsheets and presentations. Future implementations are planned that also
target images, videos and sound files.
</p>

<h2>Available Extractors</h2>

<p>
Below is a list of available Extractors, their external dependencies and remarks.
</p>

<p>These implementations may vary in performance and extraction quality.
Some use dedicated external libraries for handing a specific document format or family
of document formats, others merely use a heuristic algorithm to extract readable text
from a binary stream.
</p>

<table>
<tr>
<th>Extractor
<th>Dependencies
<th>Remarks
</tr>
<tr>
<td>ExcelExtractor
<td>Poi libraries
<td>Tests indicate that Excel 97 and higher are supported. Both the full-text and metadata are retrieved.
</tr>
<tr>
<td>HtmlExtractor
<td>Htmlparser
<td>--
</tr>
<tr>
<td>MimeExtractor
<td>JavaMail
<td>An Extractor for message/rfc822 and message/news documents. Both the most significant headers
and the body are extracted. Any attachments are ignored.
</tr>
<tr>
<td>OfficeExtractor
<td>Poi libraries
<td>An Extractor that can be used as a fall-back when the MIME type identifier
was able to identify a document as an MS Office document but was not able to further classify it,
e.g. as an MS Word file. Both text and metadata are extracted.
</tr>
<tr>
<td>OpenDocumentExtractor
<td>--
<td>Extracts full-text and metadata from OpenDocument files and is backwards compatible with older
OpenOffice (1.x) and StarOffice (6.x and 7.x) documents.
</tr>
<tr>
<td>PdfExtractor
<td>PDFBox
<td>Extracts full-text and metadata from all PDF versions.
</tr>
<tr>
<td>PlainTextExtractor
<td>--
<td>--
</tr>
<tr>
<td>PowerPointExtractor
<td>Poi libraries
<td>Text and metadata are extracted.
Text extraction is noisy but sufficient for text indexing, if you're willing to accept that
your index will contain non-word symbols.
</tr>
<tr>
<td>PresentationsExtractor
<td>Poi libraries
<td>Apparently Presentations files can have an OLE structure similar to MS Office files or use a document
structure similar to WordPerfect. In both cases text can be extracted. In the first case metadata is
also extracted.
</tr>
<tr>
<td>PublisherExtractor
<td>Poi libraries
<td>Poi is only used for document metadata retrieval, text retrieval uses a heuristic string extraction algorithm.
</tr>
<tr>
<td>QuattroExtractor
<td>Poi libraries
<td>Only recent Quattro Formats, as used by Quattro Pro 7 and Quattro Pro X3, are supported as these have a
structure similar to MS Office documents. Older versions are not supported.
Poi is only used for metadata retrieval, text retrieval uses a heuristic string extraction algorithm in both cases.
</tr>
<tr>
<td>RtfExtractor
<td>None (uses the JRE's RTFEditorKit)
<td>Only document text is extracted. Otherwise no known issues.
</tr>
<tr>
<td>VisioExtractor
<td>Poi libraries
<td>Poi is only used for document metadata retrieval, text retrieval uses a heuristic string extraction algorithm.
</tr>
<tr>
<td>WordExtractor
<td>Poi libraries
<td>Tests indicate that Word 97 and higher are supported. Both text and metadata are extracted.
</tr>
<tr>
<td>WordPerfectExtractor
<td>--
<td>Implementation only extracts full-text. Text is extracted from WordPerfect
documents from version 4.2 up to WordPerfect X3 (tested with 4.2, 5.0, 5.1/5.2 and X3, all created using
WordPerfect X3), except for the 5.1/5.2 Far East format. Tests revealed that for WordPerfect 5.0 and 5.1
the document metadata also ends up at the start of the extracted full-text.
</tr>
<tr>
<td>WorksExtractor
<td>--
<td>Implementation only extracts text and apparently only works well on Works 3.0 and 4.0 documents
and Works 4.0/2000 spreadsheets. Other versions typically produce garbage, if anything at all.
</tr>
<tr>
<td>XmlExtractor
<td>--
<td>Extracts all PCDATA and attribute values in the order in which they appear in the document.
</tr>
</table>

<p>
Note regarding the Poi libraries: in accidental cases Poi cannot process a document correctly,
leading to some sort of Exception. In that case the Extractor typically catches and disposes of
the Exception and falls back to applying a heuristic string extraction algorithm on the binary stream,
which very often works surprisingly well on MS Office formats.
</p>

<h2>Example</h2>

<p>
The following code demonstrates how to apply an Extractor on a given File and dump the extraction
results to System.out (using NTriples encoding):
</p>

<pre class="code">
<font color="#804040"> 1 </font><font color="#2e8b57"><b>public</b></font> <font color="#2e8b57"><b>class</b></font> ExtractorExample {
<font color="#804040"> 2 </font>    <font color="#2e8b57"><b>public</b></font> <font color="#2e8b57"><b>static</b></font> <font color="#2e8b57"><b>void</b></font> main(String[] args) <font color="#2e8b57"><b>throws</b></font> Exception {
<font color="#804040"> 3 </font>        <font color="#0000ff">// create a MimeTypeIdentifier</font>
<font color="#804040"> 4 </font>        MimeTypeIdentifier identifier = <font color="#804040"><b>new</b></font> MagicMimeTypeIdentifier();
<font color="#804040"> 5 </font>
<font color="#804040"> 6 </font>        <font color="#0000ff">// create an ExtractorRegistry containing all available</font>
<font color="#804040"> 7 </font>        <font color="#0000ff">// ExtractorFactories</font>
<font color="#804040"> 8 </font>        ExtractorRegistry extractorRegistry = <font color="#804040"><b>new</b></font> DefaultExtractorRegistry();
<font color="#804040"> 9 </font>
<font color="#804040">10 </font>        <font color="#0000ff">// read as many bytes of the file as desired by the MIME type identifier</font>
<font color="#804040">11 </font>        File file = <font color="#804040"><b>new</b></font> File(<font color="#ff00ff">&quot;somefile.someextension&quot;</font>);
<font color="#804040">12 </font>        FileInputStream stream = <font color="#804040"><b>new</b></font> FileInputStream(file);
<font color="#804040">13 </font>        BufferedInputStream buffer = <font color="#804040"><b>new</b></font> BufferedInputStream(stream);
<font color="#804040">14 </font>        <font color="#2e8b57"><b>byte</b></font>[] bytes = IOUtil.readBytes(buffer, identifier.getMinArrayLength());
<font color="#804040">15 </font>        stream.close();
<font color="#804040">16 </font>
<font color="#804040">17 </font>        <font color="#0000ff">// let the MimeTypeIdentifier determine the MIME type of this file</font>
<font color="#804040">18 </font>        String mimeType = identifier.identify(bytes, file.getPath(), <font color="#ff00ff">null</font>);
<font color="#804040">19 </font>
<font color="#804040">20 </font>        <font color="#0000ff">// skip when the MIME type could not be determined</font>
<font color="#804040">21 </font>        <font color="#804040"><b>if</b></font> (mimeType == <font color="#ff00ff">null</font>) {
<font color="#804040">22 </font>            System.err.println(<font color="#ff00ff">&quot;MIME type could not be established.&quot;</font>);
<font color="#804040">23 </font>            <font color="#804040"><b>return</b></font>;
<font color="#804040">24 </font>        }
<font color="#804040">25 </font>
<font color="#804040">26 </font>        <font color="#0000ff">// create the RDFContainer that will hold the RDF model</font>
<font color="#804040">27 </font>        URI uri = URIImpl.create(file.toURI().toString());
<font color="#804040">28 </font>        Model model = <font color="#804040"><b>new</b></font> RepositoryModel(<font color="#ff00ff">false</font>);
<font color="#804040">29 </font>        model.open();
<font color="#804040">30 </font>        RDFContainer container = <font color="#804040"><b>new</b></font> RDFContainerImpl(model, uri);
<font color="#804040">31 </font>
<font color="#804040">32 </font>        <font color="#0000ff">// determine and apply an Extractor that can handle this MIME type</font>
<font color="#804040">33 </font>        Set factories = extractorRegistry.get(mimeType);
<font color="#804040">34 </font>        <font color="#804040"><b>if</b></font> (factories != <font color="#ff00ff">null</font> &amp;&amp; !factories.isEmpty()) {
<font color="#804040">35 </font>            <font color="#0000ff">// just fetch the first available Extractor</font>
<font color="#804040">36 </font>            ExtractorFactory factory = (ExtractorFactory) factories.iterator()
<font color="#804040">37 </font>                    .next();
<font color="#804040">38 </font>            Extractor extractor = factory.get();
<font color="#804040">39 </font>
<font color="#804040">40 </font>            <font color="#0000ff">// apply the extractor on the specified file</font>
<font color="#804040">41 </font>            <font color="#0000ff">// (just open a new stream rather than buffer the previous stream)</font>
<font color="#804040">42 </font>            stream = <font color="#804040"><b>new</b></font> FileInputStream(file);
<font color="#804040">43 </font>            buffer = <font color="#804040"><b>new</b></font> BufferedInputStream(stream, <font color="#ff00ff">8192</font>);
<font color="#804040">44 </font>            extractor.extract(uri, buffer, <font color="#ff00ff">null</font>, mimeType, container);
<font color="#804040">45 </font>            stream.close();
<font color="#804040">46 </font>        }
<font color="#804040">47 </font>
<font color="#804040">48 </font>        <font color="#0000ff">// add the MIME type as an additional statement to the RDF model</font>
<font color="#804040">49 </font>        container.add(DATA.mimeType, mimeType);
<font color="#804040">50 </font>
<font color="#804040">51 </font>        <font color="#0000ff">// report the output to System.out</font>
<font color="#804040">52 </font>
<font color="#804040">53 </font>        container.getModel().writeTo(<font color="#804040"><b>new</b></font> PrintWriter(System.out),
<font color="#804040">54 </font>                Syntax.Ntriples);
<font color="#804040">55 </font>
<font color="#804040">56 </font>    }
<font color="#804040">57 </font>}
<font color="#804040">58 </font>
</pre>

</body>

</html>
